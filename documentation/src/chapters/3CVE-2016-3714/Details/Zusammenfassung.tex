\subsection{Zusammenfassung}\label{subsec:zusammenfassung}

Beim Ausnutzen der Schwachstelle soll ein Shell-Befehl, der in den Bilddaten "`versteckt"' ist, ausgeführt werden.\\
Dieser Shell-Befehl wird beim Einlesen der Bilddaten unzureichend gefiltert~\cite{TechnicalAnalysisImageTragick1000}.\\

Der verantwortliche https-Delegate benutzt für das Mapping den Befehl\\

\begin{lstlisting}[firstnumber=91, language=XML, caption=config/delegates.xml.in https-Delegate,label={lst:lstlisting}]
  <delegate decode="https" command="&quot;@WWWDecodeDelegate@&quot; -s -k -L -o &quot;%o&quot; &quot;https:%M&quot;"/>
\end{lstlisting}
\vspace{5mm}

wie in der Datei config/delegates.xml.in ersichtlich ist.\\

Löst man "`\&quot"' nun zu Anführungszeichen auf, ergibt sich der Befehl:\\
\begin{lstlisting}[firstnumber=1, language=Bash, caption=Aufgelöster https-Delegate-Befehl,label={lst:lstlisting}]
"@WWWDecodeDelegate@" -s -k -L -o "%o" "https:%M"
\end{lstlisting}
\vspace{5mm}

Der "`@WWWDecodeDelegate@"' ist dabei der systemspezifische Befehl für das Herunterladen einer Datei aus dem Internet - für Linux also wget, bzw. curl.\\
Im Parameter "M" liegt dabei der Aufruf für die URL, verknüpft mit dem Bash-Angriffsbefehl.\\

In der Bilddatei ist nun eine URL enthalten, zusammen mit dem Angriffscode:\\

\begin{lstlisting}[firstnumber=91, language=Bash, caption=Beispielhafter Inhalt einer Angriffsdatei,label={lst:lstlisting}]
`https://example.com"|ls "-la`
\end{lstlisting}
\vspace{5mm}

ImageMagick nimmt nun diesen Inhalt, erkennt die URL, lädt das Bild herunter und verarbeitet es wie gewünscht.\\

Dabei wird der "`angehängte"' Angriffscode aber einfach mitgegeben bis zur Shell.\\
Dies geschieht, weil der Delegate das zweite Anführungszeichen als Ende des zu verarbeitenden Strings interpretiert und an dieser Stelle aufhört.\\
Somit werden alle Zeichen hinter dem zweiten Anführungszeichen nicht mehr von ImageMagick verarbeitet, sondern direkt an die Shell weitergegeben.\\
Die Shell interpretiert die Pipe "`|"' standardmäßig als Verknüpfung. Die Ausgabe des ersten Befehls wird als Input des zweiten Befehls verwendet.\\
Da der zweite Befehl keinen Input benötigt, wird dieser einfach ausgeführt und der Angriff ist erfolgreich.\\

